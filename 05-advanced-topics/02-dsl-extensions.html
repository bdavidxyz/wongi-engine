<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>DSL extensions</title>

    <!-- Styles and fonts -->
    <link href="/wongi-engine/themes/glide/stylesheets/glide-df938af1.css" rel="stylesheet" />
    <link href="/wongi-engine/themes/glide/stylesheets/syntax-e33ab3a1.css" rel="stylesheet" />
    <link href='https://fonts.googleapis.com/css?family=Bree+Serif&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <script src="/wongi-engine/themes/glide/javascripts/modernizr-16671e9f.js"></script>
  </head>

  <body class="x05-advanced-topics x05-advanced-topics_02-dsl-extensions glide">
    <div class="page-wrapper">

      <!--[if lt IE 7]>
          <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->

      <header class="page-header" role="banner">
<a href="/wongi-engine/" class="invisilink">            <span class="book-title">Wongi::Engine</span>
</a>        <span class="book-author visuallyhidden">by úlfurinn</span>
      </header>

        <div class="content-wrapper clearfix">

          <section class="main-content" role="main">
            <div class="main-content-source">
              <h1 id="dsl-extensions">DSL extensions</h1>

<p>You can define your own elements in the rule DSL; the built-in ones are themselves defined through this mechanism. Defining custom matchers is difficult, since they generally rely on special support from the engine core (filter matchers being an exception), but custom actions could improve the readability of your rules.</p>

<p>The basic form for an extension is:</p>

<pre class="highlight ruby"><code><span class="n">dsl</span> <span class="p">{</span>
  <span class="n">section</span> <span class="p">[</span> <span class="ss">:forall</span> <span class="o">|</span> <span class="ss">:make</span> <span class="p">]</span>
  <span class="n">clause</span> <span class="ss">:my_action</span>

  <span class="c1"># one of the following:</span>

  <span class="n">body</span> <span class="p">{</span>
    <span class="c1"># ...</span>
  <span class="p">}</span>

  <span class="n">action</span> <span class="k">class</span>
  <span class="n">action</span> <span class="p">{</span> <span class="o">|</span><span class="n">token</span><span class="o">|</span>
    <span class="c1"># ...</span>
  <span class="p">}</span>

  <span class="n">accept</span> <span class="k">class</span>

<span class="p">}</span>
</code></pre>
<p><code>body</code> needs to contain other matchers or actions; it is essentially an alias for a commonly reused group.</p>

<p><code>action</code> works the same way as the built-in <code>action</code> clause, but gives it a meaningful name, which may improve readability.</p>

<p>For example, this is how you can define custom collectors:</p>

<pre class="highlight ruby"><code><span class="n">dsl</span> <span class="p">{</span>
  <span class="n">section</span> <span class="ss">:make</span>
  <span class="n">clause</span> <span class="ss">:my_collection</span>
  <span class="n">action</span> <span class="no">Wongi</span><span class="o">::</span><span class="no">Engine</span><span class="o">::</span><span class="no">SimpleCollector</span><span class="p">.</span><span class="nf">collector</span>
<span class="p">}</span>

<span class="n">rule</span> <span class="p">{</span>
  <span class="c1"># ...</span>
  <span class="n">make</span> <span class="p">{</span>
    <span class="n">my_collection</span> <span class="ss">:X</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">collection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="nf">collection</span> <span class="ss">:my_collection</span>
</code></pre>
<p><code>accept</code> defines an intermediate state in rule compilation; the class needs to define <code>#import_into(engine)</code>, which needs to return an object conforming to the action interface.</p>

            </div>
            <nav class="main-content-nav clearfix" role="navigation">
              <ul>
                <li><a href="/wongi-engine/05-advanced-topics/01-timelines.html" class="previous">Previous</a></li>
                <li></li>
              </ul>
            </nav>
          </section>

          <aside class="aside-content" role="complementary">
            <div class="aside-wrapper">

              <div class="block table-of-contents">
                <h3>Table of contents</h3>
                <nav role="navigation">
                  <ul>
                    <li class='child '><a href="/wongi-engine/">Preface</a></li><li class='parent'><span class='parent-label'>Basics</span><ul><li class='child '><a href="/wongi-engine/01-basics/01-index.html">Starting up</a></li><li class='child '><a href="/wongi-engine/01-basics/02-facts.html">Facts</a></li><li class='child '><a href="/wongi-engine/01-basics/03-simple-iteration.html">Simple iteration</a></li><li class='child '><a href="/wongi-engine/01-basics/04-simple-rules.html">Simple rules</a></li><li class='child '><a href="/wongi-engine/01-basics/05-taking-an-action.html">Taking an action</a></li><li class='child '><a href="/wongi-engine/01-basics/06-two-phase-execution.html">Two-phase execution</a></li><li class='child '><a href="/wongi-engine/01-basics/07-more-facts.html">More facts!</a></li><li class='child '><a href="/wongi-engine/01-basics/08-chain-of-causality.html">Chain of causality</a></li><li class='child '><a href="/wongi-engine/01-basics/09-queries.html">Queries</a></li><li class='child '><a href="/wongi-engine/01-basics/10-rulesets.html">Rulesets</a></li></ul></li><li class='child '><a href="/wongi-engine/02-matchers.html">Matchers</a></li><li class='child '><a href="/wongi-engine/03-actions.html">Actions</a></li><li class='child '><a href="/wongi-engine/04-overlays.html">Overlays</a></li><li class='parent'><span class='parent-label'>Advanced Topics</span><ul><li class='child '><a href="/wongi-engine/05-advanced-topics/01-timelines.html">Timelines</a></li><li class='child active'><a href="/wongi-engine/05-advanced-topics/02-dsl-extensions.html">DSL extensions</a></li></ul></li>
                  </ul>
                </nav>
              </div>
              <!--
              <div class="block translations">
                <h3>Book translations</h3>
                <p>This book is translated into
                  <a href="#">Spanish</a>
                  and <a href="#">English</a>.
                  You can help with more translations <a href="https://github.com/ulfurinn/wongi-engine">on Github</a>.
                </p>
              </div>
              -->
            </div><!-- end aside-wrapper -->
          </aside>

        </div><!-- end content-wrapper -->

      <footer class="page-footer">

        <div class="footer-wrapper">
          <!--
          <div class="block downloads">&nbsp;
            <h3>Downloads</h3>
            <p>Download this book in
                <a href="#">PDF</a>, <a href="#">mobi</a>, and <a href="#">epub</a>
              form for free.
            </p>
          </div>
          -->
          <!-- <div class="block license">
            <h3>License</h3>
            <p>This book is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Attribution-ShareAlike</a> license.</p>
          </div>

          <div class="block open-source">
            <h3>This book is open source</h3>
            <p>The source of this book is <a href="https://github.com/ulfurinn/wongi-engine">hosted on Github</a>. Go, ahead. Check it out.</p>
          </div> -->

          <small class="small-text">Copyright 2017 <a href="http://ulfurinn.net/">úlfurinn</a> // built with Middleman</small>

        </div><!-- end footer-wrapper -->

      </footer>


    </div><!-- end page-wrapper -->

    <!-- include scripts just before the close of the body tag -->
    <script src="/wongi-engine/themes/glide/javascripts/anchor.min-9893b39a.js"></script>
    <script src="/wongi-engine/themes/glide/javascripts/glide-0e98d5e5.js"></script>
  </body>
</html>
