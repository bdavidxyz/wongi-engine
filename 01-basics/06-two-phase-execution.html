<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Two-phase execution</title>

    <!-- Styles and fonts -->
    <link href="../themes/glide/stylesheets/glide-df938af1.css" rel="stylesheet" />
    <link href="../themes/glide/stylesheets/syntax-e33ab3a1.css" rel="stylesheet" />
    <link href='https://fonts.googleapis.com/css?family=Bree+Serif&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <script src="../themes/glide/javascripts/modernizr-16671e9f.js"></script>
  </head>

  <body class="x01-basics x01-basics_06-two-phase-execution glide">
    <div class="page-wrapper">

      <!--[if lt IE 7]>
          <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->

      <header class="page-header" role="banner">
<a href="/" class="invisilink">            <span class="book-title">Wongi::Engine</span>
</a>        <span class="book-author visuallyhidden">by Ãºlfurinn</span>
      </header>

        <div class="content-wrapper clearfix">

          <section class="main-content" role="main">
            <div class="main-content-source">
              <h1 id="two-phase-execution">Two-phase execution</h1>

<p>This is a good place to mention an important detail that has caused some confusion among users.</p>

<p>People sometimes assume that the literal contents of <code>forall</code> and <code>make</code> are executed for each fact, and try to put arbitrary Ruby statements in there, but this is not what's happening. Rule declarations are interpreted <strong>once</strong> in the compilation phase which builds internal structures corresponding to the declaration, and those structures are then traversed when facts are added. Any statement that is not part of the rule DSL will not be recognized by the compiler and will not have the effect you intended. Any custom code must be wrapped in appropriate rule DSL clauses.</p>

<p>As a consequence of this, any Ruby variable used in a matcher declaration will effectively become constant in the rule execution phase, keeping the value that was visible during compilation. One common example is trying to use <code>Time.now</code> in a template, expecting it to evaluate at the moment of matching. The <a href="../02-matchers.html#assign"><code>assign</code></a> matcher should be used for this instead.</p>

            </div>
            <nav class="main-content-nav clearfix" role="navigation">
              <ul>
                <li><a href="05-taking-an-action.html" class="previous">Previous</a></li>
                <li><a href="07-more-facts.html" class="next">Next</a></li>
              </ul>
            </nav>
          </section>

          <aside class="aside-content" role="complementary">
            <div class="aside-wrapper">

              <div class="block table-of-contents">
                <h3>Table of contents</h3>
                <nav role="navigation">
                  <ul>
                    <li class='child '><a href="/">Preface</a></li><li class='parent'><span class='parent-label'>Basics</span><ul><li class='child '><a href="01-index.html">Starting up</a></li><li class='child '><a href="02-facts.html">Facts</a></li><li class='child '><a href="03-simple-iteration.html">Simple iteration</a></li><li class='child '><a href="04-simple-rules.html">Simple rules</a></li><li class='child '><a href="05-taking-an-action.html">Taking an action</a></li><li class='child active'><a href="06-two-phase-execution.html">Two-phase execution</a></li><li class='child '><a href="07-more-facts.html">More facts!</a></li><li class='child '><a href="08-chain-of-causality.html">Chain of causality</a></li><li class='child '><a href="09-queries.html">Queries</a></li><li class='child '><a href="10-rulesets.html">Rulesets</a></li></ul></li><li class='child '><a href="../02-matchers.html">Matchers</a></li><li class='child '><a href="../03-actions.html">Actions</a></li><li class='child '><a href="../04-overlays.html">Overlays</a></li><li class='parent'><span class='parent-label'>Advanced Topics</span><ul><li class='child '><a href="../05-advanced-topics/01-timelines.html">Timelines</a></li><li class='child '><a href="../05-advanced-topics/02-dsl-extensions.html">DSL extensions</a></li></ul></li>
                  </ul>
                </nav>
              </div>
              <!--
              <div class="block translations">
                <h3>Book translations</h3>
                <p>This book is translated into
                  <a href="#">Spanish</a>
                  and <a href="#">English</a>.
                  You can help with more translations <a href="https://github.com/ulfurinn/wongi-engine">on Github</a>.
                </p>
              </div>
              -->
            </div><!-- end aside-wrapper -->
          </aside>

        </div><!-- end content-wrapper -->

      <footer class="page-footer">

        <div class="footer-wrapper">
          <!--
          <div class="block downloads">&nbsp;
            <h3>Downloads</h3>
            <p>Download this book in
                <a href="#">PDF</a>, <a href="#">mobi</a>, and <a href="#">epub</a>
              form for free.
            </p>
          </div>
          -->
          <!-- <div class="block license">
            <h3>License</h3>
            <p>This book is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Attribution-ShareAlike</a> license.</p>
          </div>

          <div class="block open-source">
            <h3>This book is open source</h3>
            <p>The source of this book is <a href="https://github.com/ulfurinn/wongi-engine">hosted on Github</a>. Go, ahead. Check it out.</p>
          </div> -->

          <small class="small-text">Copyright 2017</small>

        </div><!-- end footer-wrapper -->

      </footer>


    </div><!-- end page-wrapper -->

    <!-- include scripts just before the close of the body tag -->
    <script src="../themes/glide/javascripts/anchor.min-9893b39a.js"></script>
    <script src="../themes/glide/javascripts/glide-0e98d5e5.js"></script>
  </body>
</html>
